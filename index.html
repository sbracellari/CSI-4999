<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
	<title>Buddy Bot - A Programmer's Best Buddy.</title>
	<link rel="stylesheet" media="all" href="./chat-bubble/component/styles/setup.css">
	<link rel="stylesheet" media="all" href="./chat-bubble/component/styles/says.css">
	<link rel="stylesheet" media="all" href="./chat-bubble/component/styles/reply.css">
	<link rel="stylesheet" media="all" href="./chat-bubble/component/styles/typing.css">
	<link rel="stylesheet" media="all" href="./chat-bubble/component/styles/input.css">
	<style>
	  body {
      background: #adebeb;
    }
    .bubble-wrap, .bubble-container{
      background: #d6f5f5;
    }
	  .bubble-container .input-wrap textarea {
		  margin: 0;
		  width: calc(100% - 30px);
    }
    .topnav {
  overflow: hidden;
  background-color: #7cb5c0;
}

.topnav a {
  color: #f2f2f2;
  text-align: center;
  padding: 14px 16px;
  text-decoration: none;
  font-size: 17px;
  display:flex;
  justify-content: center;
}

.topnav a:hover {
  background-color: #bbebf0;
  color:#7cb5c0;
  font-size: 24px;
}

.topnav a.home {
  background-color: #7cb5c0;
  color: #7cb5c0;
  font-size: 24px;
}
	</style>
</head>
<body>
  <div style="height: auto;">
  <div class="topnav">
    <a class="home" href="index.html">Home</a>
  </div>
  <div style="color:#7cb5c0;font-size: 24px;text-align: center;">
    <h2>BUDDY BOT - A Programmer's Best Friend</h2>
  </div>
  <div style='display: flex; justify-content: center'> 
    <img 
      src="https://wallpaperaccess.com/full/557726.png" 
      alt="buddy bot image"
      style='height: 375px;'
      usemap="#evil"
    > 
  </div>
  <map name="evil">
    <area shape="rect" coords="34,44,270,350" alt="buddybot" href="index.html">
  </map>
  </div>

<!----ASHLEY ADD AN HTML IMAGE MAP TO THE TIP OF BUDDY BOT to turn him 'evil' !!-->
<!---- the script -->
<script src="./chat-bubble/component/Bubbles.js"></script>

<!-- container element for chat window -->
<div id="buddy-bot"></div>

<script>
// initialize by constructing a named function...
// ...and add text processing plugin:
var chatWindow = new Bubbles(document.getElementById("buddy-bot"), "chatWindow", {
  // the one that we care about is inputCallbackFn()
  // this function returns an object with some data that we can process from user input
  // and understand the context of it

  // this is an example function that matches the text user typed to one of the answer bubbles
  // this function does no natural language processing
  // this is where you may want to connect this script to NLC backend.
  inputCallbackFn: function(o) {
    // do this if programming answer not found
    var miss = function() {
      chatWindow.talk(
        {
          "i-dont-get-it": {
            says: [
              "I cannot answer that question currently, hopefully I can reply soon!"
            ],
            reply:[{
              question: "I have a programming question",
              answer: "programming"
            },
            {
              question: "I just want to chat",
              answer: "chat"
            }]
          }
        },
        "i-dont-get-it"
      )
    }

    // do this if programming answer found
    var match = function(response, url) {
      var talk = url === null ? 
        {
          says: [response],
          reply: [
            {
              question: "I just want to chat",
              answer: "chat"
             }
          ]
        }
      : (
        link = `<a href=${url} target='_blank' rel='noopener noreferrer'>${url}</a>`,
        {
          says: [
            response,
            "This is where I found your answer: " + link,
            "Was that helpful?"
          ],
          reply:[
              {
                question: "Yes",
                answer: "yes"
              }, 
              {
                question: "No",
                answer: "no"
              }
            ]
        }
      )

      chatWindow.talk(
        {
          "i-get-it": talk
        },
        "i-get-it"
      )
    }

    // do this for chatting purposes
    var chat = function(response) {
      chatWindow.talk(
        {
          "i-get-it": {
            says: [response],
            reply:[{
              question: "I have a programming question",
              answer: "programming"
            }]
          }
        },
        "i-get-it"
      )
    }

    reply = get_reply()

    reply === 'programming' ? (
      question_error = o.input.length > 75,

      question_error ? (
          match(
            "Your question is too long. Please try to limit it to 75 characters.", 
            null
          )
      ) : (
get_response(o.input)
          .then(data => {
            let response = data.response
            let url = data.url

            // if no answer is found, an empty string will be returned
            response === '' ? miss() : match(response, url)
        }) 
      )
    ) : (
      get_chat(o.input)
        .then(data => {
          let response = data.response
          chat(response)
      })   
    )
  }
}) // done setting up chat-bubble

// conversation object
var convo = {
  ice: {
    says: [
      "Hello! Welcome to Buddy Bot - A Programmer's Best Buddy.", 
      "I'm an interactive chatbot designed to help you with all of your programming needs.", 
      "If you have a programming question, please type it below. Or, if you just want to chat with me, click on the 'I just want to chat' option.",
    ],
    reply: [
      {
        question: "I just want to chat",
        answer: "chat"
      }
    ]
  },
  chat: {
    says: [
      "Great! I'm always happy to talk.", 
      "Type whatever you'd like in the chat box below, or, if you have a programming question, you can click the 'I have a programming question' option."
    ],
    reply: [
      {
        question: "I have a programming question",
        answer: "programming"
      }
    ]
  },
  programming: {
    says: ["Type your question in the chat box below, and I'll be happy to answer."],
    reply: [
      {
        question: "I just want to chat",
        answer: "chat"
      }
    ]
  },
  yes: {
    says: [
      "Wonderful! I'm glad I could help.",
      "You can type another programming question below, or click the 'I just want to chat' option if you'd like to chat."
    ],
    reply: [
      {
        question: "I just want to chat",
        answer: "chat"
      }
    ] 
  },
  no: {
    says: [
      "I'm sorry I couldn't find the right answer for you. You can either try to ask again, ask a different question, or click the 'I just want to chat' option if you would just like to chat."
    ],
    reply: [
      {
        question: "I just want to chat",
        answer: "chat"
      }
    ] 
  }
}

// pass JSON to your function and you're done!
chatWindow.talk(convo)
</script>
</body>
