<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Buddy Bot - A Programmer's Best Buddy.</title>
  <link rel="stylesheet"href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <link rel="stylesheet" href="chat-bubble\component\styles\bb.css">
	<link rel="stylesheet" media="all" href="./chat-bubble/component/styles/setup.css">
	<link rel="stylesheet" media="all" href="./chat-bubble/component/styles/says.css">
	<link rel="stylesheet" media="all" href="./chat-bubble/component/styles/reply.css">
	<link rel="stylesheet" media="all" href="./chat-bubble/component/styles/typing.css">
	<link rel="stylesheet" media="all" href="./chat-bubble/component/styles/input.css">
</head>

<body>

<div id="evil-button">
    <a button id="buttonOfEvil" button onclick="evil=!evil; evilBuddy(); myFunction(); evilTitle(); change(); pictureChange(); changeToEvil(); evilBubbleWrap();">------</button></a>
</div>


<div id="title" div style="width:800px; margin:0 auto;">
<p>BUDDY BOT: A PROGRAMMER'S BEST FRIEND</p>
</div>

<div class="navbar">
  <div id="buttons">
    <a href="https://github.com/sbracellari/buddy-bot">GITHUB</a>
    <a href="https://sbracellari.github.io/buddy-bot/">HOME</a>
  </div>
    <!----<link rel="stylesheet" href="chat-bubble\component\styles\evilbb.css" id="theme">--->
    <!---<<button id="switch">Evil Buddy Bot</button>--->
     <!---<a href="https://sbracellari.github.io/buddy-bot/index.html" onclick="javascript:void window.open('https://sbracellari.github.io/buddy-bot/index.html','1606601172636','width=700,height=500,toolbar=0,menubar=0,location=0,status=1,scrollbars=1,resizable=1,left=0,top=0');return false;">FAQ</a>-->
</div>


<!--script to change header text for evil bb-->
<script>
  function myFunction() {
    var title = document.getElementById("title");
    if (title.innerHTML === "BUDDY BOT: A PROGRAMMER'S WORST NIGHTMARE") {
      title.innerHTML = "BUDDY BOT: A PROGRAMMER'S BEST FRIEND";
    } else {
      title.innerHTML = "BUDDY BOT: A PROGRAMMER'S WORST NIGHTMARE";
    }
  }
  </script>

<h1>
  <div class="fade-in">
    <img id="normalBuddy" data-color="0" class="image" img src="buddypng.png" alt="buddy bot image"style="width:754px;height:378px;">
  </div>
</h1>

<!--script to swap between images-->
<script>
  let normalBuddy = document.getElementById("normalBuddy");
  let buttonOfEvil = document.getElementById("buttonOfEvil");
  buttonOfEvil.addEventListener("click", changeToEvil);
  function changeToEvil() {
    var images = [ 
      "buddypng.png",
      "557726 (1).png"
    ];
    var imageNum = parseInt(normalBuddy.dataset.color);
    var buddySwap = imageNum === 0 ? 1 : 0;
    normalBuddy.src = images[buddySwap];
    normalBuddy.dataset.color = buddySwap;
  }
  </script>
<!--changes background theme to black-->
<script>
  function evilBuddy(){
    var element = document.body;
    element.classList.toggle("evil-buddy");
  }
</script>

<script>
  function evilBubbleWrap(){
    var element = document.getElementById("bubble-wrap")
    element.classList.toggle("evil-bubble-wrap");
  }
</script>


<!---- the script -->
<script src="./chat-bubble/component/Bubbles.js"></script>

<!-- container element for chat window -->
<div id="buddy-bot"></div>

<!--Possible css switch (11-28-20)-->
<!--<script>
  document.getElementById('switch').onclick = function() {
  if (document.getElementById('theme').href == "chat-bubble\component\styles\evilbb.css") {
    document.getElementById('theme').href = "chat-bubble\component\styles\bb.css";
  } else {
    document.getElementById('theme').href = "chat-bubble\component\styles\evilbb.css";
  }
};
</script>-->

<script>
var evil = false 
// initialize by constructing a named function...
// ...and add text processing plugin:
var chatWindow = new Bubbles(document.getElementById("buddy-bot"), "chatWindow", {
  // the one that we care about is inputCallbackFn()
  // this function returns an object with some data that we can process from user input
  // and understand the context of it

  // this is an example function that matches the text user typed to one of the answer bubbles
  // this function does no natural language processing
  // this is where you may want to connect this script to NLC backend.
  inputCallbackFn: function(o) {
    // do this if programming answer not found
    var miss = function() {
      chatWindow.talk(
        {
          "i-dont-get-it": {
            says: [
              "I cannot answer that question currently, hopefully I can reply soon!"
            ],
            reply:[{
              question: "I have a programming question",
              answer: "programming"
            },
            {
              question: "I just want to chat",
              answer: "chat"
            }]
          }
        },
        "i-dont-get-it"
      )
    }

    // do this if programming answer found
    var match = function(response, url) {
      var talk = url === null ? 
        {
          says: [response],
          reply: [
            {
              question: "I just want to chat",
              answer: "chat"
             }
          ]
        }
      : (
        link = `<a href=${url} target='_blank' rel='noopener noreferrer'>${url}</a>`,
        {
          says: [
            response,
            "This is where I found your answer: " + link,
            "Was that helpful?"
          ],
          reply:[
              {
                question: "Yes",
                answer: "yes"
              }, 
              {
                question: "No",
                answer: "no"
              }
            ]
        }
      )

      chatWindow.talk(
        {
          "i-get-it": talk
        },
        "i-get-it"
      )
    }

    // do this for chatting purposes
    var chat = function(response) {
      chatWindow.talk(
        {
          "i-get-it": {
            says: [response],
            reply:[{
              question: "I have a programming question",
              answer: "programming"
            }]
          }
        },
        "i-get-it"
      )
    }

    reply = get_reply()

    reply === 'programming' ? (
      question_error = o.input.length > 75,

      question_error ? (
          match(
            "Your question is too long. Please try to limit it to 75 characters.", 
            null
          )
      ) : (
get_response(o.input)
          .then(data => {
            let response = data.response
            let url = data.url

            // if no answer is found, an empty string will be returned
            response === '' ? miss() : match(response, url)
        }) 
      )
    ) : (
      get_chat(o.input)
        .then(data => {
          let response = data.response
          chat(response)
      })   
    )
  }
}) // done setting up chat-bubble

// conversation object
var convo = {
  ice: {
    says: [
      "Hello! Welcome to Buddy Bot - A Programmer's Best Buddy.", 
      "I'm an interactive chatbot designed to help you with all of your programming needs.", 
      "If you have a programming question, please type it below. Or, if you just want to chat with me, click on the 'I just want to chat' option.",
    ],
    reply: [
      {
        question: "I just want to chat",
        answer: "chat"
      }
    ]
  },
  chat: {
    says: [
      "Great! I'm always happy to talk.", 
      "Type whatever you'd like in the chat box below, or, if you have a programming question, you can click the 'I have a programming question' option."
    ],
    reply: [
      {
        question: "I have a programming question",
        answer: "programming"
      }
    ]
  },
  programming: {
    says: ["Type your question in the chat box below, and I'll be happy to answer."],
    reply: [
      {
        question: "I just want to chat",
        answer: "chat"
      }
    ]
  },
  yes: {
    says: [
      "Wonderful! I'm glad I could help.",
      "You can type another programming question below, or click the 'I just want to chat' option if you'd like to chat."
    ],
    reply: [
      {
        question: "I just want to chat",
        answer: "chat"
      }
    ] 
  },
  no: {
    says: [
      "I'm sorry I couldn't find the right answer for you. You can either try to ask again, ask a different question, or click the 'I just want to chat' option if you would just like to chat."
    ],
    reply: [
      {
        question: "I just want to chat",
        answer: "chat"
      }
    ] 
  }
}

// pass JSON to your function and you're done!
chatWindow.talk(convo)
</script>
</body>
